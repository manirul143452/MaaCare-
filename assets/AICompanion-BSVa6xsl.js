import{c as v,r as s,j as e,a as V}from"./index-DoYr3QT2.js";import{g as B}from"./geminiService-DXcPCxJB.js";import{T as P}from"./trash-2-kUyRSetY.js";import{S as O}from"./shield-alert--SPy5h2L.js";import{U as F}from"./user-CpKiKtjj.js";import{L as D}from"./loader-circle-CaRgQr9H.js";import{X as J}from"./x-CKQHuuuw.js";import{I as W}from"./image-DBeUlve8.js";import{C as Y}from"./camera-DprGbXaU.js";import{S as G}from"./send-BuIbJBc1.js";import"./index-CvX4IAyf.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],X=v("arrow-down",K);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],y=v("bot",Q);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],T=v("scan",Z),j="maacare_ai_chat_history",me=()=>{const[i,l]=s.useState([]),[c,w]=s.useState(""),[d,N]=s.useState(!1),[o,k]=s.useState(null),[_,I]=s.useState(null),[q,E]=s.useState(!0),S=s.useRef(null),p=s.useRef(null),m=s.useRef(null),u=s.useRef(null);s.useEffect(()=>{const t=localStorage.getItem(j);if(t)try{const r=JSON.parse(t).map(n=>({...n,timestamp:new Date(n.timestamp)}));l(r)}catch(a){console.error("Failed to parse chat history",a),g()}else g()},[]),s.useEffect(()=>{i.length>0&&localStorage.setItem(j,JSON.stringify(i))},[i]);const g=()=>{l([{id:"1",role:"assistant",content:"Hello! I'm your MaaCare AI Companion. I'm equipped with Vision! You can upload a photo of a rash, a baby's symptom, or even a nutrition label, and I'll help you analyze it. What's on your mind today?",timestamp:new Date}])},H=()=>{window.confirm("Are you sure you want to clear your chat history? This cannot be undone.")&&(localStorage.removeItem(j),g())},z=()=>{var t;(t=S.current)==null||t.scrollIntoView({behavior:"smooth"})},$=()=>{if(p.current){const{scrollTop:t,scrollHeight:a,clientHeight:r}=p.current;E(a-t<=r+100)}};s.useEffect(()=>{z()},[i,d]);const M=t=>{var r;const a=(r=t.target.files)==null?void 0:r[0];if(a){if(a.size>4*1024*1024){alert("Please select an image smaller than 4MB.");return}const n=new FileReader;n.onloadend=()=>{k(n.result),I(a.type)},n.readAsDataURL(a)}},C=()=>{k(null),I(null),m.current&&(m.current.value=""),u.current&&(u.current.value="")},L=async t=>{if(t.preventDefault(),!c.trim()&&!o||d)return;const a={id:Date.now().toString(),role:"user",content:c||(o?"[Attached Image]":""),imageUrl:o||void 0,timestamp:new Date},r=[...i,a];l(r);const n=c,A=o,R=_;w(""),C(),N(!0);try{const f=r.slice(-6).map(h=>({role:h.role,content:h.content}));let x;A&&R&&(x={data:A.split(",")[1],mimeType:R});const b=await B(f,n,x),U={id:(Date.now()+1).toString(),role:"assistant",content:b||"I'm processing your request. One moment please.",timestamp:new Date};l(h=>[...h,U])}catch(f){console.error(f);const x={id:(Date.now()+2).toString(),role:"assistant",content:"I apologize, but I encountered an error while analyzing your request. This could be due to connection issues or file size. Please try again.",timestamp:new Date};l(b=>[...b,x])}finally{N(!1)}};return e.jsxs("div",{className:"max-w-4xl mx-auto h-[calc(100vh-12rem)] flex flex-col relative",children:[e.jsxs("div",{className:"bg-white rounded-t-[2.5rem] border border-gray-100 p-6 flex items-center justify-between shadow-sm z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-14 h-14 bg-teal-100 text-teal-600 rounded-[1.25rem] flex items-center justify-center relative shadow-inner",children:[e.jsx(y,{size:32}),e.jsx("div",{className:"absolute -top-1 -right-1 bg-amber-400 text-white p-1 rounded-full border-2 border-white animate-pulse",children:e.jsx(V,{size:12,fill:"currentColor"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-black text-gray-900 tracking-tight",children:"MaaCare Companion"}),e.jsxs("span",{className:"flex items-center gap-1 px-2.5 py-0.5 bg-teal-50 text-teal-600 rounded-full border border-teal-100 text-[9px] font-black uppercase tracking-widest",children:[e.jsx(T,{size:10})," Multimodal"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-gray-400 font-bold uppercase tracking-tighter",children:"Vision & Audio Active"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:H,className:"p-3 bg-gray-50 text-gray-400 rounded-2xl hover:bg-red-50 hover:text-red-500 transition-all border border-transparent hover:border-red-100",title:"Clear Chat History",children:e.jsx(P,{size:20})}),e.jsx("button",{className:"hidden sm:flex p-3 bg-gray-50 text-gray-400 rounded-2xl hover:bg-gray-100 transition-all",children:e.jsx(O,{size:20})})]})]}),e.jsxs("div",{ref:p,onScroll:$,className:"flex-1 bg-white border-x border-gray-100 overflow-y-auto p-6 space-y-8 no-scrollbar scroll-smooth",children:[i.map(t=>e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"} animate-in fade-in slide-in-from-bottom-2 duration-300`,children:e.jsxs("div",{className:`flex gap-4 max-w-[88%] ${t.role==="user"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-2xl flex items-center justify-center shrink-0 shadow-sm ${t.role==="user"?"bg-pink-100 text-pink-600":"bg-teal-100 text-teal-600"}`,children:t.role==="user"?e.jsx(F,{size:20}):e.jsx(y,{size:20})}),e.jsx("div",{className:`flex flex-col gap-2 ${t.role==="user"?"items-end":"items-start"}`,children:e.jsxs("div",{className:`p-5 rounded-[1.75rem] text-[15px] leading-relaxed shadow-sm border ${t.role==="user"?"bg-pink-600 text-white rounded-tr-none border-pink-500":"bg-gray-50 text-gray-700 rounded-tl-none border-gray-100"}`,children:[t.imageUrl&&e.jsx("div",{className:"mb-4 rounded-2xl overflow-hidden border-2 border-white/20 shadow-xl max-w-sm group relative",children:e.jsx("img",{src:t.imageUrl,alt:"Context",className:"w-full h-auto object-cover max-h-72 transition-transform duration-500 group-hover:scale-105"})}),e.jsx("p",{className:"whitespace-pre-wrap font-medium",children:t.content}),e.jsx("div",{className:`text-[9px] mt-3 font-black uppercase tracking-widest opacity-60 ${t.role==="user"?"text-right":"text-left"}`,children:t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})]})},t.id)),d&&e.jsx("div",{className:"flex justify-start animate-pulse",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-teal-50 text-teal-400 flex items-center justify-center",children:e.jsx(y,{size:20})}),e.jsxs("div",{className:"bg-gray-50 p-5 rounded-[1.75rem] rounded-tl-none border border-gray-100 flex items-center gap-3",children:[e.jsx(D,{className:"animate-spin text-teal-600",size:18}),e.jsx("span",{className:"text-sm text-gray-400 font-black uppercase tracking-widest",children:"MaaCare is thinking..."})]})]})}),e.jsx("div",{ref:S})]}),!q&&e.jsx("button",{onClick:z,className:"absolute bottom-32 right-8 p-3 bg-white text-teal-600 rounded-full shadow-2xl border border-gray-100 animate-bounce z-10",children:e.jsx(X,{size:20})}),e.jsxs("div",{className:"p-6 bg-white rounded-b-[2.5rem] border border-gray-100 shadow-sm relative",children:[o&&e.jsxs("div",{className:"mb-6 flex items-center gap-4 animate-in slide-in-from-bottom-4 bg-gray-50 p-4 rounded-3xl border border-dashed border-teal-200",children:[e.jsxs("div",{className:"relative group overflow-hidden rounded-2xl shadow-xl",children:[e.jsx("img",{src:o,className:"w-24 h-24 object-cover",alt:"Preview"}),e.jsx("div",{className:"absolute inset-0 bg-teal-600/20 animate-pulse flex items-center justify-center",children:e.jsx(T,{className:"text-white",size:24})}),e.jsx("button",{onClick:C,className:"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full shadow-lg hover:bg-red-600 transition-colors",children:e.jsx(J,{size:14})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-black text-gray-800 uppercase tracking-widest mb-1",children:"Visual context added"}),e.jsx("p",{className:"text-xs text-gray-400 font-medium",children:"Click send to analyze this image."})]})]}),e.jsxs("form",{onSubmit:L,className:"flex gap-3 items-center",children:[e.jsx("input",{type:"file",ref:m,onChange:M,accept:"image/*",className:"hidden"}),e.jsx("input",{type:"file",ref:u,onChange:M,accept:"image/*",capture:"environment",className:"hidden"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{var t;return(t=m.current)==null?void 0:t.click()},className:"p-4 text-gray-400 hover:text-teal-600 hover:bg-teal-50 rounded-2xl transition-all border border-gray-100 shadow-sm",title:"Upload Photo",children:e.jsx(W,{size:22})}),e.jsx("button",{type:"button",onClick:()=>{var t;return(t=u.current)==null?void 0:t.click()},className:"p-4 text-gray-400 hover:text-teal-600 hover:bg-teal-50 rounded-2xl transition-all border border-gray-100 shadow-sm",title:"Take Photo",children:e.jsx(Y,{size:22})})]}),e.jsx("input",{type:"text",value:c,onChange:t=>w(t.target.value),placeholder:o?"Add a question about this photo...":"Ask me anything about your health...",className:"flex-1 px-6 py-4 rounded-2xl border-2 border-gray-50 bg-gray-50 outline-none focus:bg-white focus:border-teal-500 transition-all text-[15px] font-medium placeholder:text-gray-300"}),e.jsx("button",{type:"submit",disabled:!c.trim()&&!o||d,className:"bg-teal-600 text-white p-4 rounded-2xl hover:bg-teal-700 disabled:opacity-50 transition-all shadow-xl shadow-teal-100 flex items-center justify-center min-w-[3.5rem] active:scale-95",children:d?e.jsx(D,{className:"animate-spin",size:24}):e.jsx(G,{size:24})})]})]})]})};export{me as default};
